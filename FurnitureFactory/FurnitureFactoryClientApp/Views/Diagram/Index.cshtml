@using System.Web
@model FurnitureFactoryBusinessLogics.ViewModels.DiagramViewModel[]

@{ ViewData["Title"] = "Diagram"; }

<div class="text-center">
    <form asp-action="Index">
        <div class="form-group">
            <label value="Покупка" class="control-label"></label>
            <select name="purchaseId" id="furniture" class="form-control" asp-items="ViewBag.Purchases"></select>
        </div>
        <div class="form-group">
            <input type="submit" value="Сформировать диаграммы" class="btn btn-primary" />
        </div>
        <div id="FurnitureCount"></div>
        <div id="FurniturePrice"></div>
    </form>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChartFurnitureCount);
      google.charts.setOnLoadCallback(drawChartFurniturePrice);

    @if (Model != null) {
        <text>
        function drawChartFurnitureCount() {
            var data = new google.visualization.DataTable();
            data.addColumn('string', '@Html.Raw(HttpUtility.JavaScriptStringEncode(Model[0].ColumnName))');
            data.addColumn('number', '@Html.Raw(HttpUtility.JavaScriptStringEncode(Model[0].ValueName))');
          @foreach (var row in Model[0].Data) {
          <text>
          data.addRow(['@Html.Raw(HttpUtility.JavaScriptStringEncode(row.Item1))', @row.Item2]);
          </text>
          }
                    var options = {
              'title': '@Html.Raw(HttpUtility.JavaScriptStringEncode(Model[0].Title))',
                       'width':1200,
                       'height':900};

            var chart = new google.visualization.PieChart(document.getElementById('FurnitureCount'));
            chart.draw(data, options);
        }
        function drawChartFurniturePrice() {
            var data = new google.visualization.DataTable();
            data.addColumn('string', '@Html.Raw(HttpUtility.JavaScriptStringEncode(Model[1].ColumnName))');
            data.addColumn('number', '@Html.Raw(HttpUtility.JavaScriptStringEncode(Model[1].ValueName))');
          @foreach (var row in Model[1].Data) {
          <text>
          data.addRow(['@Html.Raw(HttpUtility.JavaScriptStringEncode(row.Item1))', @row.Item2]);
          </text>
          }
                    var options = {
              'title': '@Html.Raw(HttpUtility.JavaScriptStringEncode(Model[1].Title))',
                       'width':1200,
                       'height':900};

            var chart = new google.visualization.ColumnChart(document.getElementById('FurniturePrice'));
            chart.draw(data, options);
        }
        </text>
    }
</script>
