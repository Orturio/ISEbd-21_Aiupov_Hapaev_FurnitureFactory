@using System.Web
@model FurnitureFactoryBusinessLogics.ViewModels.DiagramViewModel[]

@{ ViewData["Title"] = "Diagram"; }

<div class="text-center">
    <form asp-action="Index">
        <div class="form-group">
            <label value="Мебель" class="control-label"></label>
            <select name="furnitureId" id="purchase" class="form-control" asp-items="ViewBag.Furnitures"></select>
        </div>
        <div class="form-group">
            <input type="submit" value="Сформировать диаграммы" class="btn btn-primary" />
        </div>
        <div id="PurchaseCount"></div>
        <div id="PurchasePrice"></div>
    </form>
</div>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
}

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

      google.charts.load('current', {'packages':['corechart']});
      google.charts.setOnLoadCallback(drawChartPurchaseCount);
    google.charts.setOnLoadCallback(drawChartPurchasePrice);

    @if (Model != null) {
        <text>
     function drawChartPurchaseCount() {
            var data = new google.visualization.DataTable();
            data.addColumn('string', '@Html.Raw(HttpUtility.JavaScriptStringEncode(Model[0].ColumnName))');
            data.addColumn('number', '@Html.Raw(HttpUtility.JavaScriptStringEncode(Model[0].ValueName))');
          @foreach (var row in Model[0].Data) {
          <text>
          data.addRow(['@Html.Raw(HttpUtility.JavaScriptStringEncode(row.Item1))', @row.Item2]);
          </text>
          }
             var options = {
             'title': '@Html.Raw(HttpUtility.JavaScriptStringEncode(Model[0].Title))',
             'width':1200,
             'height': 900,
             is3D: true};

            var chart = new google.visualization.PieChart(document.getElementById('PurchaseCount'));
            chart.draw(data, options);
        }
     function drawChartPurchasePrice() {
            var data = new google.visualization.DataTable();
            data.addColumn('string', '@Html.Raw(HttpUtility.JavaScriptStringEncode(Model[1].ColumnName))');
            data.addColumn('number', '@Html.Raw(HttpUtility.JavaScriptStringEncode(Model[1].ValueName))');
          @foreach (var row in Model[1].Data) {
          <text>
          data.addRow(['@Html.Raw(HttpUtility.JavaScriptStringEncode(row.Item1))', @row.Item2]);
          </text>
          }
            var options = {
            'title': '@Html.Raw(HttpUtility.JavaScriptStringEncode(Model[1].Title))',
            'width':1200,
            'height': 900,};

            var chart = new google.visualization.ColumnChart(document.getElementById('PurchasePrice'));
            chart.draw(data, options);
        }
        </text>
    }
</script>
